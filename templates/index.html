<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Pointer lock demo</title>
    <link type="text/css" rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
    
            
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-8  offset-lg-2">
                <h3 class="mt-5">Live Streaming</h3>
            </div>
        </div>
        <div class="row">
            <button class="btn-move-camera" id="UP" value="UP">UP</button>
            <button class="btn-move-camera" id="DOWN" value="DOWN">DOWN</button>
            <button class="btn-move-camera" id="LEFT" value="LEFT">LEFT</button>
            <button class="btn-move-camera" id="RIGHT" value="RIGHT">RIGHT</button>
            <button class="btn-move-camera" id="MIDDLE" value="MIDDLE">MIDDLE</button>
            <button class="btn-refresh-camera" id="REFRESH" value="REFRESH">REFRESH</button>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
            <script type = "text/javascript" language = "javascript">
                var mqtt;
                var reconnectTimeout = 2000;
                var host='{{ MQTT_BROKER_ADDRESS }}'; //change this
                var port=parseInt('{{ MQTT_BROKER_WEBSOCKET_PORT }}');
                var username='{{ MQTT_BROKER_USER }}';
                var password='{{ MQTT_BROKER_PASSWORD }}';
                var lastMsg;
                function onFailure(message) {
                    console.log("Connection Attempt to Host "+host+"Failed");
                    setTimeout(MQTTconnect, reconnectTimeout);
                }
                function onMessageArrived(msg){
                    out_msg="Message received "+msg.payloadString+"<br>";
                    out_msg=out_msg+"Message received Topic "+msg.destinationName;
                    console.log(out_msg);
                }
        
                function onConnect() {
                // Once a connection has been made, make a subscription and send a message.
            
                    console.log("Connected ");
                    // mqtt.subscribe('{{ MQTT_TOPIC_CAMERA }}');
                    // message = new Paho.MQTT.Message("Client Connected Sucessfully");
                    // message.destinationName = '{{ MQTT_TOPIC_CAMERA }}';
                    // mqtt.send(message);
                }
        
                function MQTTconnect() {
                    console.log("connecting to "+ host +" "+ port);
                    mqtt = new Paho.MQTT.Client(host,port,"clientjs");
                    var options = {
                        timeout: 3,
                        userName : username,
                        password : password,
                        onSuccess: onConnect,
                        onFailure: onFailure,
                        };
                    mqtt.onMessageArrived = onMessageArrived;
                    mqtt.connect(options); //connect
                }
                var buttons = document.getElementsByClassName('btn-move-camera');
                for(var i = 0; i < buttons.length; i++) {
                    console.log(i);
                    button = buttons[i];
                    buttons[i].onclick = function(){
                        try {
                            message = new Paho.MQTT.Message(JSON.stringify({"action": this.value}));
                            message.destinationName = '{{ MQTT_TOPIC_CAMERA }}';
                            mqtt.send(message)
                            console.log('Completed!', message);
                        } catch(err) {
                            console.error(`Error: ${err}`);
                        }
                }};
            </script>
            <script>
                MQTTconnect();
            </script>
        </div>
    </div>
    <div class="information">
        <h1>Pointer lock demo</h1>

        <p>Click on the canvas area and your mouse will directly control the ball inside the canvas. You can press escape to return to the standard expected state.</p>
    </div>

    <div id="container">
        <img class='img' src="{{ url_for('video_feed') }}" alt="" width="640"/>
        <canvas id="reticleCanvas" width="640" height="360" background-image: url({{ url_for('video_feed') }});>
            Your browser does not support HTML5 canvas
        </canvas>
    </div>
    <div id="tracker"></div>


    <script src="{{url_for('static', filename='app.js')}}"></script>
</body>

</html>